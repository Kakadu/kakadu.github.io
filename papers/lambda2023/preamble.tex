\makeatletter
\@ifclassloaded{beamer}{
  % get rid of header navigation bar
  \setbeamertemplate{headline}{}
  % get rid of bottom navigation symbols
  \setbeamertemplate{navigation symbols}{}
  % get rid of footer
  %\setbeamertemplate{footline}{}
  \setbeamertemplate{section in toc} {\inserttocsectionnumber.~\inserttocsection}
  \usefonttheme{professionalfonts}
}
{}
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{ifxetex,ifluatex}
\newif\ifxetexorluatex
    \ifxetex
        \xetexorluatextrue
    \else
        \ifluatex
            \xetexorluatextrue
        \else
            \xetexorluatexfalse
        \fi
    \fi

\ifxetexorluatex
    \usepackage{fontspec}
    \usepackage{unicode-math}
    \setmainfont[Ligatures=TeX]{CMU Serif}
    \setsansfont[Ligatures=TeX]{CMU Sans Serif}
    \setmathfont[Scale=MatchUppercase]{Asana Math}
    \setmonofont{Monaco for Powerline}[Scale=0.9]

%\newfontfamily{\myfiracode}[Scale=1.5,Contextuals=Alternate]{Fira Code}
%\setmonofont[Scale=0.9,BoldFont={Inconsolata Bold}]{Inconsolata}

    \usepackage{polyglossia}
    \setmainlanguage{russian}
    \setotherlanguage{english}
\else
    \usepackage[utf8]{inputenc}
    \usepackage[T2A]{fontenc}
    \usepackage[russian,english]{babel}
\fi
%\newfontfamily{\cyrillicfonttt}{Monaco for Powerline}
%  [ Contextuals=Alternate
%  , Scale=0.8
%  , BoldFont=MonacoB
%  ]

%\newfontfamily\dejaVuSansMono{DejaVu Sans Mono}
% https://github.com/vjpr/monaco-bold/raw/master/MonacoB/MonacoB.otf
%\newfontfamily\monacoB{MonacoB}

\usepackage{fontawesome}
% \newfontfamily{\FA}{Font Awesome 5 Free} % some glyphs missing
\expandafter\def\csname faicon@facebook\endcsname{{\FA\symbol{"F09A}}}
\def\faQuestionSign{{\FA\symbol{"F059}}}
\def\faQuestion{{\FA\symbol{"F128}}}
\def\faExclamation{{\FA\symbol{"F12A}}}
\def\faUploadAlt{{\FA\symbol{"F093}}}
\def\faLemon{{\FA\symbol{"F094}}}
\def\faPhone{{\FA\symbol{"F095}}}
\def\faCheckEmpty{{\FA\symbol{"F096}}}
\def\faBookmarkEmpty{{\FA\symbol{"F097}}}

\newcommand{\faGood}{\textcolor{ForestGreen}{\faThumbsUp}}
\newcommand{\faBad}{\textcolor{red}{\faThumbsODown}}
\newcommand{\faWrong}{\textcolor{red}{\faTimes}}
\newcommand{\faMaybe}{\textcolor{blue}{\faQuestion}}
\newcommand{\faCheckGreen}{\textcolor{ForestGreen}{\faCheck}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\usepackage{relsize} % \mathlarger{..}
\usepackage{hyperref}
%\usepackage{comment}
%\usepackage{easyReview}
%\usepackage{changes}
% What to pick?
%https://mengxiangxi.info/BLOG/research/2021/09/20/Good-practice-revising-latex.html

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
\usepackage[useregional]{datetime2}
\usepackage{soul} % for \st that strikes through
\usepackage[normalem]{ulem} % \sout

\usepackage{stmaryrd}
\newcommand{\sem}[1]{\ensuremath{\llbracket #1\rrbracket}}

% We should use the following commands as \ocaml{} to prevent chewing
% extra space
\newcommand{\ocaml}{\textsc{OCaml}}
\newcommand{\OCaml}{\ocaml}
\newcommand{\haskell}{\textsc{Haskell}}
\newcommand{\Haskell}{\haskell}
\newcommand{\Rust}{\textsc{Rust}}
\newcommand{\Coq}{\textsc{Coq}}
\newcommand{\Java}{\textsc{Java}}
\newcommand{\CXX}{\textsc{C++}}

\author{Косарев Дмитрий}
\institute{матмех}

\addtobeamertemplate{title page}{}{
    \begin{center}
        {\tiny Дата сборки: \DTMtoday}
    \end{center}
}

%\let\thefootnote\relax\footnotetext{Put your text here}
\DeclareMathOperator{\arr}{\rightarrow}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{tikz}
% For every picture that defines or uses external nodes, you'll have to
% apply the 'remember picture' style. To avoid some typing, we'll apply
% the style to all pictures.
\tikzstyle{every picture}+=[remember picture]

% By default all math in TikZ nodes are set in inline mode. Change this to
% displaystyle so that we don't get small fractions.
\everymath{\displaystyle}
\usetikzlibrary{cd}
\usepackage{tikz-cd}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{amsthm}

%%\DeclareMathOperator{->}{\rightarrow}


\usepackage{amsmath}
\usepackage{amssymb}
%\usepackage{amsfonts}
\usepackage{scalerel}
\DeclareMathOperator*{\myvee}{\scalerel*{\vee}{\sum}}
\DeclareMathOperator*{\mywedge}{\scalerel*{\wedge}{\sum}}

%
%\usepackage{tabulary}
%
%% sudo aptget install ttf-mscorefonts-installer
%%\setmainfont{Times New Roman}
%%\setsansfont[Mapping=tex-text]{DejaVu Sans}
%
%%\setmonofont[Scale=1.0,
%%    BoldFont=lmmonolt10-bold.otf,
%%    ItalicFont=lmmono10-italic.otf,
%%    BoldItalicFont=lmmonoproplt10-boldoblique.otf
%%]{lmmono9-regular.otf}
%
% https://tex.stackexchange.com/questions/380799/warning-when-adding-package-minted
\usepackage[autostyle]{csquotes}

% color options
\definecolor{YellowGreen} {HTML}{B5C28C}
\definecolor{ForestGreen} {HTML}{009B55}
\definecolor{MyPurple}{HTML}{7f007f}
\def\HaskellTypeclassColor\PYG{k+kt}
\def\HaskellCommentColor\PYG{c+c1}

%\ifxetexorluatex
%  \usepackage{fontawesome}
%\else
%\fi


\newif\ifminted
\newif\iflistings

\listingstrue
%\mintedtrue

\iflistings
    \usepackage{listings}

    %\newcommand{\inline}[1]{\lstinline{haskell}{#1}}
    % TODO: https://tex.stackexchange.com/questions/4198/emphasize-word-beginning-with-uppercase-letters-in-code-with-lstlisting-package
    \definecolor{eclipseGreen}{RGB}{63,127,95}

    % https://tex.stackexchange.com/a/4199
    \makeatletter
    \newcommand*\ocamlidstyle{%
            \expandafter\id@style\the\lst@token\relax
    }
    \def\id@style#1#2\relax{%
            \ifcat#1\relax\else
                    \ifnum`#1=\uccode`#1%
                             \ttfamily\bfseries\color{MyPurple}
                    \else
                                                \ttfamily
                    \fi
            \fi
    }
    \makeatother


    \lstdefinelanguage{ocaml}{
        basicstyle=\ttfamily   % Вот тут надо стиль ставить, а не у идентификаторов
%        , identifierstyle=\ocamlidstyle  % конфликтует, если идентификаторы стартуют с подчерка
        %, commentstyle=\HaskellCommentColor\itshape\HaskellCommentColor
        , sensitive=true
        %
        , classoffset=0
        , keywords={ fun, function, and, let, rec, in, match, with, when
            , class, type, of, do, as, val
            , inherit, module, struct, sig
            , if, then, else
            , assert, true, false, begin, end
            , Some, None
        }
        , keywordstyle=\ttfamily\bfseries\color{MyPurple} %\underbar
        , classoffset=1
        , morekeywords={pure,empty,select,branch,oneOf}
        , keywordstyle=\color{MyPurple}
        , classoffset=2
        , morekeywords={Monad,Applicative,Selective,String
            ,Either,Left,Right
            ,Maybe,Some,None
        }
        , keywordstyle=\PYG{k+kt}
        , classoffset=0,
        %keywordstyle=[2]{\color{orange}},
        otherkeywords={::},
        %identifierstyle=\fontfamily{cmtt}\selectfont\ttfamily,
        %basewidth={0.5em,0.5em},
        columns=fixed,
        %fontadjust=true,
        %literate={->}{{$\to$}}3 {===}{{$\equiv$}}1 {=/=}{{$\not\equiv$}}1 {|>}{{$\triangleright$}}3 {\\/}{{$\vee$}}2 {/\\}{{$\wedge$}}2 {>=}{{$\ge$}}1 {<=}{{$\le$}} 1,
        , morecomment=[s]{(*}{*)}
        , commentstyle=\color{eclipseGreen} % style of comments
        %, literate={\$}{{\textcolor{blue}{\$}}}1
        %, literate={<\$>}{{\textcolor{RawSienna}{\ <\$>\ } }}1
        %           {>?>}{{\textcolor{RawSienna}{\ >?>\ } }}1
    }
    \lstset{ language=ocaml }
    \lstnewenvironment{mlisting}[1][]{\lstset{inputencoding=latin1, language=ocaml,#1}%
    }{%
    }

    %\def\mlinline[1]{\lstinline[langauge=ocaml]{#1}} % is not possible
    \ifpdftex
        \usepackage{etoolbox}
        \expandafter\patchcmd\csname \string\lstinline\endcsname{%
            \leavevmode
            \bgroup
        }{%
            \leavevmode
            \ifmmode\hbox\fi
            \bgroup
        }{}{%
            \typeout{Patching of \string\lstinline\space failed!}%
        }
    \fi
\fi

\ifminted
    \usepackage[cache=true]{minted}
    \usemintedstyle{perldoc}
    \def\hsinline{\mintinline{haskell}}
    \def\mlinline{\mintinline[escapeinside=||]{ocaml}}

%\def\hsinline{\mintinline{haskell}}
%\def\inline{\hsinline}
\fi


\usepackage{tikz} % Мощный пакет для создание рисунков, однако может очень сильно замедлять компиляцию
\usetikzlibrary{decorations.pathreplacing,calc,shapes,positioning,tikzmark}
\newcounter{tmkcount}
\usepackage{tikzsymbols}

\tikzset{
    use tikzmark/.style={
        remember picture,
        overlay,
        execute at end picture={
            \stepcounter{tmkcount}
        },
    },
    tikzmark suffix={-\thetmkcount}
}
%\newcommand\centerarc{} % just for safety
\def\tikzHighlight(#1)(#2){
  \draw[fill=gray,opacity=0.1]
    ([shift={(-3pt,2ex)}]pic cs:#1)
    rectangle
    ([shift={(3pt,-0.65ex)}]pic cs:#2);
}


\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\theta}{\vartheta}
\renewcommand{\kappa}{\varkappa}
\renewcommand{\rho}{\varrho}
\renewcommand{\phi}{\varphi}